import React from 'react'
import { Card, Row, Col, Statistic, Table, Tag, Progress, Alert, Space, Button } from 'antd'
import { 
  SecurityScanOutlined, 
  ExclamationCircleOutlined, 
  CheckCircleOutlined,
  ClockCircleOutlined,
  WarningOutlined
} from '@ant-design/icons'

const VulnerabilityManagement: React.FC = () => {
  // Mock vulnerability data
  const vulnerabilityStats = {
    total: 47,
    critical: 3,
    high: 12,
    medium: 18,
    low: 14,
    resolved: 32,
    inProgress: 8,
    open: 7
  }

  const vulnerabilities = [
    {
      key: '1',
      id: 'CVE-2024-0001',
      title: 'Buffer Overflow in Network Driver',
      severity: 'Critical',
      status: 'Open',
      component: 'network/driver.c',
      discoveredDate: '2024-01-10',
      assignee: 'Security Team'
    },
    {
      key: '2',
      id: 'CVE-2024-0002',
      title: 'Race Condition in Memory Manager',
      severity: 'High',
      status: 'In Progress',
      component: 'mm/memory.c',
      discoveredDate: '2024-01-08',
      assignee: 'Kernel Team'
    },
    {
      key: '3',
      id: 'STATIC-001',
      title: 'Potential NULL Pointer Dereference',
      severity: 'Medium',
      status: 'Resolved',
      component: 'fs/ext4/inode.c',
      discoveredDate: '2024-01-05',
      assignee: 'FS Team'
    }
  ]

  const columns = [
    {
      title: 'ID',
      dataIndex: 'id',
      key: 'id',
      render: (text: string) => <code>{text}</code>
    },
    {
      title: 'Title',
      dataIndex: 'title',
      key: 'title'
    },
    {
      title: 'Severity',
      dataIndex: 'severity',
      key: 'severity',
      render: (severity: string) => {
        const colors = {
          'Critical': 'red',
          'High': 'orange',
          'Medium': 'yellow',
          'Low': 'green'
        }
        return <Tag color={colors[severity as keyof typeof colors]}>{severity}</Tag>
      }
    },
    {
      title: 'Status',
      dataIndex: 'status',
      key: 'status',
      render: (status: string) => {
        const colors = {
          'Open': 'red',
          'In Progress': 'blue',
          'Resolved': 'green'
        }
        return <Tag color={colors[status as keyof typeof colors]}>{status}</Tag>
      }
    },
    {
      title: 'Component',
      dataIndex: 'component',
      key: 'component',
      render: (text: string) => <code style={{ fontSize: '12px' }}>{text}</code>
    },
    {
      title: 'Discovered',
      dataIndex: 'discoveredDate',
      key: 'discoveredDate'
    },
    {
      title: 'Assignee',
      dataIndex: 'assignee',
      key: 'assignee'
    }
  ]

  return (
    <div>
      <div style={{ marginBottom: '24px' }}>
        <h1 style={{ margin: 0, display: 'flex', alignItems: 'center', gap: '12px' }}>
          <SecurityScanOutlined />
          Vulnerability Management
        </h1>
        <p style={{ margin: '8px 0 0 0', color: '#666' }}>
          Track and manage security vulnerabilities across kernel and BSP components
        </p>
      </div>

      <Alert
        message="Security Alert"
        description="3 critical vulnerabilities require immediate attention. Review and assign remediation tasks."
        type="error"
        showIcon
        style={{ marginBottom: '24px' }}
        action={
          <Button size="small" danger>
            View Critical Issues
          </Button>
        }
      />

      <Row gutter={[16, 16]} style={{ marginBottom: '24px' }}>
        <Col xs={24} sm={12} md={6}>
          <Card>
            <Statistic
              title="Total Vulnerabilities"
              value={vulnerabilityStats.total}
              prefix={<SecurityScanOutlined />}
              valueStyle={{ color: '#1890ff' }}
            />
          </Card>
        </Col>
        <Col xs={24} sm={12} md={6}>
          <Card>
            <Statistic
              title="Critical"
              value={vulnerabilityStats.critical}
              prefix={<ExclamationCircleOutlined />}
              valueStyle={{ color: '#ff4d4f' }}
            />
          </Card>
        </Col>
        <Col xs={24} sm={12} md={6}>
          <Card>
            <Statistic
              title="In Progress"
              value={vulnerabilityStats.inProgress}
              prefix={<ClockCircleOutlined />}
              valueStyle={{ color: '#faad14' }}
            />
          </Card>
        </Col>
        <Col xs={24} sm={12} md={6}>
          <Card>
            <Statistic
              title="Resolved"
              value={vulnerabilityStats.resolved}
              prefix={<CheckCircleOutlined />}
              valueStyle={{ color: '#52c41a' }}
            />
          </Card>
        </Col>
      </Row>

      <Row gutter={[16, 16]} style={{ marginBottom: '24px' }}>
        <Col xs={24} lg={12}>
          <Card title="Severity Distribution" size="small">
            <Space direction="vertical" style={{ width: '100%' }}>
              <div>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}>
                  <span>Critical</span>
                  <span>{vulnerabilityStats.critical}</span>
                </div>
                <Progress 
                  percent={(vulnerabilityStats.critical / vulnerabilityStats.total) * 100} 
                  strokeColor="#ff4d4f"
                  showInfo={false}
                />
              </div>
              <div>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}>
                  <span>High</span>
                  <span>{vulnerabilityStats.high}</span>
                </div>
                <Progress 
                  percent={(vulnerabilityStats.high / vulnerabilityStats.total) * 100} 
                  strokeColor="#faad14"
                  showInfo={false}
                />
              </div>
              <div>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}>
                  <span>Medium</span>
                  <span>{vulnerabilityStats.medium}</span>
                </div>
                <Progress 
                  percent={(vulnerabilityStats.medium / vulnerabilityStats.total) * 100} 
                  strokeColor="#1890ff"
                  showInfo={false}
                />
              </div>
              <div>
                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}>
                  <span>Low</span>
                  <span>{vulnerabilityStats.low}</span>
                </div>
                <Progress 
                  percent={(vulnerabilityStats.low / vulnerabilityStats.total) * 100} 
                  strokeColor="#52c41a"
                  showInfo={false}
                />
              </div>
            </Space>
          </Card>
        </Col>
        <Col xs={24} lg={12}>
          <Card title="Resolution Progress" size="small">
            <div style={{ textAlign: 'center' }}>
              <Progress
                type="circle"
                percent={Math.round((vulnerabilityStats.resolved / vulnerabilityStats.total) * 100)}
                format={(percent) => `${percent}%\nResolved`}
                strokeColor="#52c41a"
                size={120}
              />
              <div style={{ marginTop: '16px', fontSize: '14px', color: '#666' }}>
                {vulnerabilityStats.resolved} of {vulnerabilityStats.total} vulnerabilities resolved
              </div>
            </div>
          </Card>
        </Col>
      </Row>

      <Card title="Recent Vulnerabilities" size="small">
        <Table
          columns={columns}
          dataSource={vulnerabilities}
          pagination={{ pageSize: 10 }}
          size="small"
        />
      </Card>
    </div>
  )
}

export default VulnerabilityManagement